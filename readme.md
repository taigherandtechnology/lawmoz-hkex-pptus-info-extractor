# LawMoZ - 港股招股书信息提取器

## 项目简介
这是一个由 LawMoZ 品牌推出、AI 驱动的 Chrome 浏览器扩展，用于自动提取港交所(HKEX)招股书PDF文件中的关键信息。扩展程序可以快速识别并提取公司基本信息和专业服务机构信息，大大提高信息收集效率。

- 插件简介：由 AI 驱动的港股招股书信息提取工具 by LawMoZ
- 插件 icon：2025-06 全新品牌形象“小人趴睡觉”图标，支持16/32/48/128像素多尺寸，已在manifest.json配置
- 插件名称与简介已在manifest.json中同步更新

---

## API 密钥配置说明

本项目部分功能依赖 DeepSeek AI 接口，需要用户自行配置 API 密钥。

### 配置方法
1. 打开 `utils/config.js` 文件，找到如下配置：
   ```js
   ai: {
       enabled: true,
       apiKey: '', // 此处请填写你的 DeepSeek API Key，如 'sk-xxxxxx'
       endpoint: 'https://api.deepseek.com/v1/chat/completions'
   }
   ```
2. 将 `apiKey` 字段填写为你在 DeepSeek 平台申请到的 API Key。

### 获取 API Key
- 访问 [DeepSeek 官网](https://deepseek.com/) 注册并获取你的 API Key。

### 安全提醒
- 请勿将包含真实 API Key 的 `config.js` 文件上传到 GitHub 或分享给他人。
- 项目已默认不包含任何敏感密钥，所有密钥需用户自行填写。
- `.gitignore` 已自动忽略常见敏感文件。

如有疑问可联系开发者。

---

## 近期主要变更

- 插件名称由“港股招股书信息提取器”升级为“LawMoZ - 港股招股书信息提取器”
- 插件简介升级为“由 AI 驱动的港股招股书信息提取工具 by LawMoZ”
- 插件主icon替换为全新品牌“小人趴睡觉”图标，manifest.json已配置多尺寸
- readme.md 已同步品牌、icon、manifest变更说明

---


## 主要功能

### 1. 公司基本信息提取
- 公司英文名称、中文名称和公司类型：检索在整本招股书中第一次出现的"Application Proof of"和第一次出现的"The publication of this Application Proof is required by The"之间的文本，使用AI进行解析出中英文和公司类型。
- 行业信息：检索在整本招股书中第一次出现的"We are", 提取该段落，并提交给 ai进行总结行业。

### 2. 专业服务机构信息提取
- 保荐人 (Sponsors)：根据公司基本信息提取中拿到的公司类型，如果是开曼公司，搜索”Directors and
Parties Involved" 如果非开曼公司，搜索“Directors, Supervisors and
Parties Involved”，获得页码。找到连续的页码，该几页就是所需的信息章节。在这几页信息章节上，搜索 sponsors定位那一页。将那一页内容给 ai，让 ai 提取保荐人名称。
- 会计师/审计师：在信息章节基础上，搜索reporting accountants，定位会计/审计师的那一页，将那一页内容给 ai，让 ai 提取会计/审计师名称；
- 行业顾问：在信息章节基础上，搜索industry consultant，定位行业顾问的那一页，将那一页内容给 ai，让 ai 提取行业顾问名称；
- 法律顾问：在信息章节基础上，搜索 legal advisor to our company，定位行业顾问的那一页，将那一页内容给 ai，让 ai 提取法律顾问我名称；
  * 公司境内律师
  * 公司境外律师
  * 保荐人境内律师
  * 保荐人境外律师

### 3. 其他功能
- 一键提取所有信息
- 复制提取结果
- 自动识别并下载中文版招股书

---

### 一键下载中文招股书功能说明（2025-06升级）

#### 功能简介
用户在获取英文招股书链接后，无需手动查找中文版本，只需点击“一键下载中文招股书”按钮，系统会自动根据英文PDF链接推算出对应的中文PDF链接并下载。

#### 推算规则
- 英文PDF链接示例：  
  `https://www1.hkexnews.hk/app/sehk/2024/107054/documents/sehk24123101889.pdf`
- 中文PDF链接生成规则：  
  1. 将英文PDF链接最后的数字（如01889）减去1，得到01888  
  2. 在.pdf前加上“_c”，即变成01888_c.pdf  
  3. 拼成最终中文PDF链接：  
     `https://www1.hkexnews.hk/app/sehk/2024/107054/documents/sehk24123101888_c.pdf`

#### 使用方法
1. 用户在浏览器中打开港交所英文招股书PDF页面（地址栏以.pdf结尾）。
2. 点击插件弹窗中的“一键下载中文招股书”按钮。
3. 系统自动读取当前标签页真实PDF链接，推算并跳转到对应的中文PDF，无需用户手动修改链接。

#### 技术原理与兼容性说明
- 插件通过Chrome扩展API（chrome.tabs.query）自动获取当前激活标签页的真实URL，彻底兼容所有PDF页面（包括Chrome自带PDF预览环境）。
- 只要你在PDF页面点击本按钮，功能100%可用。
- 插件需在manifest.json中声明"tabs"权限，否则无法读取当前页面URL。

#### 常见问题与排查建议
- 若提示“请在PDF页面点击本按钮”，请确认当前标签页地址栏以.pdf结尾。
- 若提示“插件权限异常，无法获取页面链接”，请联系开发者确认插件已声明tabs权限。
- 若目标中文PDF不存在，建议用户核查招股书实际发布情况。

#### 适用范围
- 仅适用于HKEX招股书，且英文与中文PDF文件命名规则符合上述规律的情况。

---

## 提取策略说明

---

### 2025-06 重大更新：关键词智能提取优化
- **短语关键词（如“Legal Advisors to our Company”）支持跨行、大小写不敏感正则匹配**，能自动识别如“Legal Advisors to\nOur Company”等换行写法。
- **单词型关键词**依然支持大小写不敏感查找。
- **提取片段长度**：每次命中关键词后，自动提取关键词前50个字符+关键词本身+后500个字符，确保上下文完整。

### 2025-06 重大更新：章节定位兜底兼容机制

---

### 2025-06 UI与品牌升级记录

#### LawMoZ 品牌升级与视觉统一
- 欢迎页和 popup 主界面均采用 LawMoZ 品牌名、主色（#5864e8）、统一 logo（assets/lawmoz_logo.png）。
- 欢迎页主图标下方新增品牌标语：“LawMoZ 让交易律师不再 no more sleep”，突出产品定位。
- popup 标题统一为“LawMoZ - 港股招股书信息提取器”。

#### 署名与跳转体验优化
- popup 标题下方新增“Proudly presented by @Siber”灰色小字，@Siber为超链接，点击可通过 chrome.runtime.getURL + window.open 跳转至欢迎页（welcome page.html），保证在扩展内跳转始终有效。
- 原 footer “关于我”按钮及相关说明已移除，所有关于作者入口集中于主界面。

#### 说明文案与版本号调整
- popup 页底部说明内容替换为：
  - 版本号 v1.0.0
  - 本工具旨在提高信息获取效率，提取结果仅供参考
  - 请结合完整招股书进行决策
- 原有“🎉港股招股书信息提取器 - 版本号 v1.0🎉”等描述已废弃。

#### 交互与用户体验细节
- @Siber 链接采用品牌色，hover 保持下划线，整体视觉风格统一。
- 署名与下方状态提示间距优化，避免界面拥挤。
- 所有跳转 welcome page.html 的入口均保证兼容 Chrome 扩展环境，避免 a 标签直接跳转失效。
- 欢迎页 favicon 与主图标一致，提升品牌一致性。

#### 版本及变更记录
- 版本号升级为 v1.0.0，对应 UI/品牌/说明文案的全面优化。
- 详细记录所有 UI、交互、文案变动，便于团队协作和后续维护。

---


#### Directors章节定位规则（2025-06同步修订）
- **自动过滤起始匹配项**：
  - 如果关键词匹配项数量大于10，自动忽略前3个，从第4个匹配项作为Directors章节起点。
  - 如果匹配项数量小于等于10，自动忽略前2个，从第3个匹配项作为Directors章节起点。
  - 若匹配项数量不足过滤要求，则自动降级为最后一个匹配项。
- **章节结束页码**：
  - 所有章节结束页码均由`findChapterEndPage`方法自动推算，确保章节范围准确。
- **兼容机制与日志**：
  - 非cayman公司如未找到匹配项，会自动切换为开曼公司关键词再查找。
  - 所有步骤均有详细日志输出，便于追踪和调试。
- **代码实现**：
  - 相关逻辑已在`extractor.js`的`findDirectorsSection`方法中实现，并有详细注释说明。

1. **智能章节定位与兜底兼容**
   - 系统会根据公司类型自动选择章节关键词：
     - **开曼公司**：优先检索“Directors and Parties Involved”以及“DIRECTORS AND PARTIES INVOLVED”。
     - **中国公司/非cayman公司**：优先检索“Directors, Supervisors and Parties Involved”以及“DIRECTORS, SUPERVISORS AND PARTIES INVOLVED”。
   - **自动兜底机制**：
     - 如果中国公司/非cayman公司检索不到任何“Supervisors”相关关键词（即完全找不到或匹配项数量为0），系统会自动切换为开曼公司关键词（“Directors and Parties Involved”）再次检索，最大化兼容不同招股书格式。
     - 关键词查找严格区分大小写变体，所有规则均有详细日志输出。
     - 查找时，前3个匹配页面自动忽略，从第4个开始顺延5页为主章节，若不足4个则用最后一个匹配页兜底。
     - 若依然找不到，日志会详细记录警告，Directors章节为空。

2. **专业服务机构信息提取**
   - 在定位到的章节内，系统会针对 sponsors、reporting accountants、industry consultant、legal advisor 等关键词，自动提取包含这些关键词的段落片段，并交由AI进一步解析。
   - 片段提取方式已优化为“关键词+前后定长截取”，确保无论招股书格式如何变化，都能最大化提取有效内容。
   - 详细日志会输出每个关键词提取的内容片段，便于调试和人工核查。

3. **代码维护与扩展建议**
   - 所有关键词和兜底策略均集中在 extractor.js 内统一维护，便于后续扩展和维护。
   - 若需适配新类型公司或章节命名变体，只需在 extractor.js 中补充关键词数组即可。
   - 强烈建议所有正则和提取逻辑均写详细注释，方便团队协作和后续升级。

---

### 公司基本信息提取策略
1. 公司英文名称、中文名称和公司类型：
   - 在整本招股书中，首先检索第一次出现的 "Application Proof of"，再检索第一次出现的 "The publication of this Application Proof is required by The"。
   - 提取这两个关键词之间的全部文本。
   - 将该文本交由AI进行解析，自动识别并输出公司英文名称、中文名称以及公司类型。
2. 行业信息：
   - 在整本招股书中检索第一次出现的 "We are"。
   - 提取包含该关键词的段落。
   - 将该段落内容交由AI总结归纳行业信息。

### 专业服务机构信息提取策略
1. 章节定位（新版兜底机制）：
   - 首先根据公司类型（通过公司基本信息提取获得）判断：
     - 如果为开曼公司，检索“Directors and Parties Involved”或“DIRECTORS AND PARTIES INVOLVED”；
     - 如果为中国公司，优先检索“Directors, Supervisors and Parties Involved”或“DIRECTORS, SUPERVISORS AND PARTIES INVOLVED”；
     - 如果为中国公司但上述关键词未找到（即匹配页数不足4个或完全找不到），自动切换为开曼公司关键词（“Directors and Parties Involved”），确保最大化提取成功率。
   - 查找上述关键词时，前3个查找到的页面都是无效的，从第4个查找到的页面开始，顺延5页，作为director章节（专业服务机构信息章节）。
   - 如果总共找到的匹配项不足4个，则使用最后一个匹配页及其后5页作为兜底。
   - 若仍未找到，则日志输出详细警告，directors章节为空。
   - 所有关键词和兜底逻辑均已在extractor.js中详细注释实现。
2. 保荐人（Sponsors）提取：
   - 在上述章节内检索“sponsors”关键词，定位到具体页码。
   - 提取该页全部内容，交由AI解析，输出保荐人名称。
3. 会计师/审计师提取：
   - 在上述章节内检索“reporting accountants”关键词，定位到具体页码。
   - 提取该页全部内容，交由AI解析，输出会计师/审计师名称。
4. 行业顾问提取：
   - 在上述章节内检索“industry consultant”关键词，定位到具体页码。
   - 提取该页全部内容，交由AI解析，输出行业顾问名称。
5. 法律顾问提取：
   - 在上述章节内检索“legal advisor to our company”关键词，定位到具体页码。
   - 提取该页全部内容，交由AI解析，输出以下法律顾问信息：
     * 公司境内律师
     * 公司境外律师
     * 保荐人境内律师
     * 保荐人境外律师

## 最新改进

### 2025-06 重大更新

#### 新增功能说明

- **首次安装欢迎页**：插件首次安装时，会自动在新标签页弹出 `welcome page.html`，用于展示欢迎信息、使用指南等。
  - 仅首次安装弹出，升级或重新加载不会重复弹出。
  - 欢迎页文件位于根目录 `welcome page.html`，可自定义内容。

- **关于我按钮**：在插件主界面（popup.html）底部说明文字上方，新增了一个“👾关于我”按钮。
  - 样式与主操作按钮一致，居中、小号、不突兀。
  - 点击后会自动跳转到插件欢迎页（welcome page.html），方便用户随时查看插件介绍和帮助。
  - 按钮代码及交互已集成于 popup.html 和 popup.js。

1. popup弹窗UI与交互大幅优化：
   - 所有小节标题统一使用h3标签，语义清晰，风格一致。
   - 保荐人、审计师、行业顾问等所有专业机构名称和公司信息全部以普通正文样式展示，不再加粗或特殊色，提升可读性和一致性。
   - 恢复并修正了保荐人、审计师、行业顾问等专业机构的渲染逻辑，所有小节标题和内容结构高度统一。
   - 公司基本信息区块也采用与保荐人一致的展示方式，每个字段为独立小节，h3标题+正文。
   - 进度条替换原有loading转圈动画，新增.progress-bar和.progress-inner样式，进度条圆角、平滑过渡。
   - 新增startProgressBar(duration)和finishProgressBar()方法，进度条随AI提取动态变化，提取结束自动满格。
   - 提取时主状态栏和loading提示文案统一为主色，loading文本更新为“正在为您节省睡眠时间...”。
   - 进度条动画默认30秒，实际提取完成后立即满格，极大提升用户等待体验。
   - 代码结构进一步优化，所有信息渲染逻辑和样式高度统一，便于维护和扩展。
   - 详细记录所有UI与交互变动，便于团队协作和后续维护。
2. 本地缓存逻辑优化：
   - 提取结果会自动缓存，关闭弹窗后再次打开无需重复请求API，节省token和等待时间。
   - 缓存采用chrome.storage.local（优先）和localStorage（兼容fallback）。
   - 支持一键刷新、清空缓存。
3. 其他体验改进：
   - 保持弹窗不会因点击外部而关闭。
   - 视觉风格与原始设计一致，所有样式已回退至最初版本，方便后续自定义。
   - 详细记录所有UI变动，便于团队协作和后续维护。
4. 代码注释和README同步补全，所有新旧功能、参数、返回值均有详细说明。

### 2025-06 新版extractor.js核心逻辑说明

#### 字段命名与数据一致性（重要修订）
- extractor.js 和 parser.js 之间所有片段（chunk）字段名必须严格一致，包括大小写和单复数。
    - 正确示例：auditorsChunk、industryConsultantsChunk、sponsorsChunk
    - 错误示例：reportingChunk、industryConsultantChunk（会导致解析失败和日志误报）
- 如遇“关键词片段为空”警告，请首先检查字段名是否完全一致。

#### AI片段提取与日志排查建议
- extractor.js 负责正则定位和截取各类专业服务机构片段，如 auditorsChunk、industryConsultantsChunk 等。
- parser.js 负责对这些 chunk 进一步AI解析。
- **所有传递给AI的chunk内容，必须是字符串（即把对象数组中的chunk字段拼接成字符串），绝不能直接传递包含keyword的对象数组。否则AI将无法正确识别内容。**
- 若日志显示 chunk 内容已提取但依然提示为空，极大概率是字段名不一致。
- 建议在日志中输出每个 chunk 的内容预览（如前100字），便于快速定位问题。
- 如需扩展适配更多关键词（如“核数师”、“行业专家”），请在 extractor.js 的正则配置中补充。

#### 常见问题与解决方案
- 问题：日志提示“行业顾问关键词片段为空”或“审计师关键词片段为空”，但 chunk 实际有内容。
  - 解决：检查 parser.js 和 extractor.js 的字段名是否一致。
- 问题：AI未能正确解析 chunk 内容。
  - 解决：检查 chunk 内容是否包含目标关键词，必要时扩展正则或优化AI prompt。
- 问题：日志输出内容不够详细。
  - 解决：在关键步骤增加日志输出，打印字段名和内容片段。

#### 代码维护建议
- 统一所有 chunk 字段命名风格，建议使用复数（如 auditorsChunk、consultantsChunk）。
- 任何字段名调整，需同步修改 extractor.js 和 parser.js。
- 详细注释每个正则和提取逻辑，便于后续扩展和维护。

#### 1. 章节提取与兜底策略
- 支持中国公司、开曼公司等不同类型招股书的章节智能定位。
- 对于中国公司或非cayman公司，查找“Directors, Supervisors and Parties Involved”相关章节时，若完全找不到任何匹配项，会自动切换为“Directors and Parties Involved”关键词再查一次，最大化兼容不同招股书格式。详细日志会记录切换过程。
- 关键词查找严格区分大小写变体，所有规则均有详细日志输出。
- 前3个匹配页面自动忽略，从第4个开始顺延5页为主章节，若不足4个则用最后一个匹配页兜底。
- 章节内容提取、缓存、日志、异常处理等均有详细注释。
#### 2. 主要API与参数说明
- `extractProspectusInfo()`：主入口，自动完成初始化、PDF加载、各章节提取、AI解析、结果汇总。
- `extractAllRequiredSections()`：负责所有章节的定位与文本提取，返回包含首页、Summary、Directors等所有关键信息的对象。
- `findDirectorsSection(companyType)`：根据公司类型和兜底机制查找Directors章节。
- `extractProfessionalChunks(directorsText)`：从Directors章节文本中按正则和定长提取保荐人、法律顾问、会计师等片段。
- `detectCompanyType(firstPageText)`：根据首页文本智能判断公司类型。
- 详细日志与异常处理，便于调试和维护。
#### 3. 适用范围
- 适配绝大多数港股招股书，无论公司类型、章节命名差异均可自动兼容。
- 便于后续扩展，所有提取策略和关键词均集中在extractor.js内统一维护。

### 2024-01 更新
1. 优化了行业信息提取
   - 改用"We are"语句定位方式
   - 直接提取第一个有效的业务描述
   - 使用AI将业务描述翻译为中文

2. 完善了法律顾问提取
   - 优化了法律顾问识别逻辑
   - 按法域分类存储和显示
   - 改进了重复检查机制

3. 界面优化
   - 重新设计了弹窗界面
   - 优化了信息展示结构
   - 添加了更多状态提示

## 使用说明

### 安装方法
1. 下载项目代码
2. 打开Chrome浏览器，进入扩展程序管理页面 (chrome://extensions/)
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"，选择项目文件夹

### 使用步骤
1. 打开港交所招股书PDF页面
2. 点击扩展图标打开提取工具
3. 点击"提取招股书信息"按钮
4. 等待提取完成后查看结果
5. 可以点击"复制提取结果"或"下载中文版"按钮

## 技术实现

### 核心模块
- `extractor.js`: 负责PDF文档处理和章节定位
- `parser.js`: 负责文本解析和信息提取
- `popup.js`: 负责用户界面交互

#### 【重要说明】extractor.js与parser.js之间字段名需严格一致
- 所有专业机构chunk的字段名必须统一为 `sponsorsChunk`、`auditorsChunk`、`industryConsultantsChunk`、`legalAdvisersToCompanyChunk`、`legalAdvisersToSponsorsChunk`。
- 字段名不一致会导致AI解析异常，务必保持同步修改。
- **所有传递给AI的chunk内容，必须是字符串（即把对象数组中的chunk字段拼接成字符串），绝不能直接传递包含keyword的对象数组。否则AI将无法正确识别内容。**

### 2025-06 专业服务机构短语关键词正则优化与维护说明

#### 1. 智能正则匹配与动态关键词支持
- **所有短语关键词（如“Legal Advisors to our Company”）均支持跨行、大小写不敏感正则自动匹配**，即使招股书里出现“Legal Advisors to\nOur Company”等换行写法也能自动识别。
- **支持动态关键词**：如 `Legal advisor(s)/adviser(s) to the/our [REDACTED]` 这类变体，无需手动枚举所有组合，系统会自动用正则表达式识别。
- 典型正则举例：
  ```js
  /Legal (advisors?|advisers?) to (the |our )?\[REDACTED\]/i
  ```
  - `i` 表示忽略大小写，`s` 表示支持跨行。
  - 你只需关注关键词本身，系统会自动处理各种大小写和换行情况。

#### 2. 维护与扩展建议（给不会写代码的用户）
- **所有关键词都集中在 extractor.js 的 professionalTypes 配置中统一维护。**
- 新增关键词时：
  - 对于短语，直接写全即可，系统会自动用正则处理大小写和换行。
  - 对于动态内容（如 [REDACTED]），直接写出典型格式即可。
- **如需支持更多复杂变体，可参考上面正则写法，直接扩展即可。**

#### 3. 日志与调试
- **所有提取操作都有详细日志输出**，方便开发者快速定位和修复问题。
- 日志采用 loguru 风格，信息清晰、易于追踪。

#### 4. 典型用法与操作步骤
- 打开港股招股书PDF页面，点击扩展图标，点击“提取招股书信息”即可自动完成所有信息的提取与结构化展示。
- **无需懂代码，所有操作一键完成。**

---

### 信息提取策略
1. 公司名称：从PDF首页提取，使用AI辅助识别中英文名称
2. 行业信息：定位首个"We are"语句，通过AI翻译
3. 专业机构：使用正则表达式匹配相关章节，结合AI提取具体信息

---

### 典型用法示例

假设你已经在 Chrome 浏览器中加载本扩展，打开了一份港股招股书 PDF，点击扩展图标并执行信息提取，系统会自动完成如下流程：

1. 智能定位各章节（如 Directors、Summary）。
2. 针对每种专业机构（如 sponsors、auditors、industry consultants、legal advisers），自动遍历所有短语关键词，**正则支持跨行和大小写不敏感**，确保最大化识别率。
3. 每命中一次关键词，自动提取前后上下文片段（默认前50字+关键词+后500字），并将所有片段传递给 AI 进一步结构化解析。
4. 提取结果会显示在弹窗界面，并可一键复制或下载。

#### 关键代码片段（extractor.js）

```javascript
const pattern = keyword.replace(/\s+/g, '\\s+');
// 加上 's' 修饰符，保证正则既支持大小写不敏感，也支持跨行提取
const regex = new RegExp(pattern, 'is');
const match = regex.exec(directorsText);
```

- **维护建议：** 新增或修改关键词时，务必采用上述写法，确保 `i`（忽略大小写）和 `s`（允许换行）修饰符齐全。

---

## 注意事项
- 维护或新增正则表达式时，务必加上 `i`（忽略大小写）和 `s`（允许换行）修饰符，保证提取准确率。

- 仅支持港交所招股书PDF文件
- 需要在PDF页面使用
- 提取结果可能需要人工核验

## 后续计划
- [ ] 提高信息提取准确率
- [ ] 支持更多类型的文档
- [ ] 添加批量处理功能
- [ ] 支持导出不同格式

## 贡献指南
欢迎提交Issue和Pull Request来帮助改进项目。

## 许可证
[MIT License](LICENSE)
